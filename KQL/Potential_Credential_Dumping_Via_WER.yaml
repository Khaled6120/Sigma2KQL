name: Potential Credential Dumping Via WER
id: 9a4ccd1a-3526-4d99-b980-9f9c5d3a6ff3
author: '@pbssubhash , Nasreddine Bencherchali'
date: 2022/12/08
severity: high
description: Detects potential credential dumping via Windows Error Reporting LSASS
  Shtinkering technique which uses the Windows Error Reporting to dump lsass
status: test
modified: 2022/12/09
logsource:
  category: process_creation
  product: windows
tactics:
- credential_access
relevantTechniques:
- t1003.001
query: 'DeviceProcessEvents

  | where (((ProcessCommandLine contains " -u -p " and ProcessCommandLine contains
  " -ip " and ProcessCommandLine contains " -s ") and (InitiatingProcessAccountName
  contains "AUTHORI" or InitiatingProcessAccountName contains "AUTORI") and (AccountName
  contains "AUTHORI" or AccountName contains "AUTORI")) and (FolderPath endswith "\\Werfault.exe"
  or ProcessVersionInfoOriginalFileName =~ "WerFault.exe")) and (not(InitiatingProcessFolderPath
  =~ "C:\\Windows\\System32\\lsass.exe"))'
eventGroupingSettings:
  aggregationKind: SingleAlert
queryFrequency: P1D
queryPeriod: P1D
enabled: true
entityMappings: null
sentinelEntitiesMappings: null
triggerThreshold: 0
suppressionDuration: PT5H
suppressionEnabled: false
kind: Scheduled
