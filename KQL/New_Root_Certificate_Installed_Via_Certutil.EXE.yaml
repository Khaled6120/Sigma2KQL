name: New Root Certificate Installed Via Certutil.EXE
id: d2125259-ddea-4c1c-9c22-977eb5b29cf0
author: oscd.community, @redcanary, Zach Stanford @svch0st
date: 2023/03/05
level: medium
description: 'Detects execution of "certutil" with the "addstore" flag in order to
  install a new certificate on the system.

  Adversaries may install a root certificate on a compromised system to avoid warnings
  when connecting to adversary controlled web servers.

  '
status: test
modified: 2024/03/05
logsource:
  category: process_creation
  product: windows
tactics:
- defense_evasion
relevantTechniques:
- t1553.004
query: 'DeviceProcessEvents

  | where (ProcessCommandLine contains "-addstore" or ProcessCommandLine contains
  "/addstore") and ProcessCommandLine contains "root" and (FolderPath endswith "\\certutil.exe"
  or ProcessVersionInfoOriginalFileName =~ "CertUtil.exe")'
