name: Security Privileges Enumeration Via Whoami.EXE
id: 97a80ec7-0e2f-4d05-9ef4-65760e634f6b
author: Florian Roth (Nextron Systems)
date: 2021/05/05
severity: high
description: Detects a whoami.exe executed with the /priv command line flag instructing
  the tool to show all current user privileges. This is often used after a privilege
  escalation attempt.
status: test
modified: 2023/02/28
logsource:
  category: process_creation
  product: windows
tactics:
- discovery
- privilege_escalation
relevantTechniques:
- t1033
query: 'DeviceProcessEvents

  | where (ProcessCommandLine contains " /priv" or ProcessCommandLine contains " -priv")
  and (FolderPath endswith "\\whoami.exe" or ProcessVersionInfoOriginalFileName =~
  "whoami.exe")'
eventGroupingSettings:
  aggregationKind: SingleAlert
queryFrequency: P1D
queryPeriod: P1D
enabled: true
entityMappings: null
sentinelEntitiesMappings: null
triggerThreshold: 0
suppressionDuration: PT5H
suppressionEnabled: false
kind: Scheduled
