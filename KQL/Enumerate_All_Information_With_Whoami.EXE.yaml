name: Enumerate All Information With Whoami.EXE
id: c248c896-e412-4279-8c15-1c558067b6fa
author: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
date: 2023/12/04
severity: medium
description: Detects the execution of "whoami.exe" with the "/all" flag
status: experimental
modified: 2024/03/05
logsource:
  category: process_creation
  product: windows
tactics:
- discovery
relevantTechniques:
- t1033
query: 'DeviceProcessEvents

  | where (ProcessCommandLine contains " -all" or ProcessCommandLine contains " /all")
  and (FolderPath endswith "\\whoami.exe" or ProcessVersionInfoOriginalFileName =~
  "whoami.exe")'
eventGroupingSettings:
  aggregationKind: SingleAlert
queryFrequency: P1D
queryPeriod: P1D
enabled: true
entityMappings: null
sentinelEntitiesMappings: null
triggerThreshold: 0
suppressionDuration: PT5H
suppressionEnabled: false
kind: Scheduled
