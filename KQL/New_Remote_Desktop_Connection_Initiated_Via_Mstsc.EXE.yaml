name: New Remote Desktop Connection Initiated Via Mstsc.EXE
id: 954f0af7-62dd-418f-b3df-a84bc2c7a774
author: frack113
date: 2022/01/07
severity: medium
description: 'Detects the usage of "mstsc.exe" with the "/v" flag to initiate a connection
  to a remote server.

  Adversaries may use valid accounts to log into a computer using the Remote Desktop
  Protocol (RDP). The adversary may then perform actions as the logged-on user.

  '
status: test
modified: 2023/02/03
logsource:
  category: process_creation
  product: windows
tactics:
- lateral_movement
relevantTechniques:
- t1021.001
query: 'DeviceProcessEvents

  | where (ProcessCommandLine contains " /v:" and (FolderPath endswith "\\mstsc.exe"
  or ProcessVersionInfoOriginalFileName =~ "mstsc.exe")) and (not((ProcessCommandLine
  contains "C:\\ProgramData\\Microsoft\\WSL\\wslg.rdp" and InitiatingProcessFolderPath
  =~ "C:\\Windows\\System32\\lxss\\wslhost.exe")))'
eventGroupingSettings:
  aggregationKind: SingleAlert
queryFrequency: P1D
queryPeriod: P1D
enabled: true
entityMappings: null
sentinelEntitiesMappings: null
triggerThreshold: 0
suppressionDuration: PT5H
suppressionEnabled: false
kind: Scheduled
