name: Group Membership Reconnaissance Via Whoami.EXE
id: bd8b828d-0dca-48e1-8a63-8a58ecf2644f
author: Nasreddine Bencherchali (Nextron Systems)
date: 2023/02/28
severity: medium
description: Detects the execution of whoami.exe with the /group command line flag
  to show group membership for the current user, account type, security identifiers
  (SID), and attributes.
status: test
modified: ''
logsource:
  category: process_creation
  product: windows
tactics:
- discovery
relevantTechniques:
- t1033
query: 'DeviceProcessEvents

  | where (ProcessCommandLine contains " /groups" or ProcessCommandLine contains "
  -groups") and (FolderPath endswith "\\whoami.exe" or ProcessVersionInfoOriginalFileName
  =~ "whoami.exe")'
eventGroupingSettings:
  aggregationKind: SingleAlert
queryFrequency: P1D
queryPeriod: P1D
enabled: true
entityMappings: null
sentinelEntitiesMappings: null
triggerThreshold: 0
suppressionDuration: PT5H
suppressionEnabled: false
kind: Scheduled
